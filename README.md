# utoipa-scalar-warpper

`utoipa-scalar-warpper` is a Rust library that integrates [Scalar](https://github.com/scalar/scalar) into OpenAPI
documentation generated by [utoipa](https://github.com/juhaku/utoipa). It supports multiple popular Rust web frameworks
including Actix-web, Axum, and Rocket.

> [!NOTE]
> This project is forked from [utoipa-scalar](https://github.com/juhaku/utoipa/tree/master/utoipa-scalar), and the
> examples are also from `utoipa`'s [examples](https://github.com/juhaku/utoipa/tree/master/examples).
>
> The difference from the original project is that the original project fetches scalar resources via CDN, while this
> project fetches scalar-api-reference from npm and integrates it with the web server. It also uses `maud` as the template
> engine and provides rich configuration options for scalar.
>
> Since static resources are embedded into the binary, this will increase the size of the binary artifact. If you have
> strict limitations on the original binary size, consider using the officially maintained `utoipa-scalar` from `utoipa`.

## Features

- Seamless integration with `utoipa`
- Support for multiple Rust web frameworks: Actix-web, Axum, Rocket
- Configurable themes and appearance settings

## Installation

Add the following dependencies to your `Cargo.toml`:

```toml
[dependencies]
utoipa = { version = "5.4.0", features = ["axum_extras"] } # or "axum_extras", "rocket_extras"
utoipa-scalar-warpper = "0.1.0"
```

Enable the corresponding features based on your web framework:

- Actix-web: `features = ["actix-web"]`
- Axum: `features = ["axum"]`
- Rocket: `features = ["rocket"]`

## Usage

### Using with Axum

```rust
use std::net::{Ipv4Addr, SocketAddr};
use tokio::net::TcpListener;
use utoipa::{OpenApi};
use utoipa_axum::router::OpenApiRouter;
use utoipa_scalar_warpper::Scalar;

#[tokio::main]
async fn main() -> Result<(), std::io::Error> {
    let (router, api) = OpenApiRouter::with_openapi(ApiDoc::openapi())
        .nest("/api/v1/todos", todo::router())
        .split_for_parts();

    let router = router.merge(
        Scalar::new(api)
            .with_url("/scalar")
            .with_title("My API Documentation"),
    );

    let address = SocketAddr::from((Ipv4Addr::LOCALHOST, 8080));
    let listener = TcpListener::bind(&address).await?;
    axum::serve(listener, router.into_make_service()).await
}

#[derive(OpenApi)]
#[openapi(
    tags(
        (name = "todos", description = "Todo items management API")
    )
)]
struct ApiDoc;
```

### Using with Actix-web

```rust
use actix_web::{App, HttpServer};
use utoipa::{OpenApi};
use utoipa_scalar_warpper::Scalar;

#[actix_web::main]
async fn main() -> Result<(), impl std::error::Error> {
    #[derive(OpenApi)]
    #[openapi(
        tags(
            (name = "todos", description = "Todo items management API")
        )
    )]
    struct ApiDoc;

    HttpServer::new(move || {
        App::new()
            .service(
                Scalar::new(ApiDoc::openapi())
                    .with_url("/scalar")
                    .with_title("My API Documentation")
            )
            // Add your other routes...
    })
    .bind(("127.0.0.1", 8080))?
    .run()
    .await
}
```

### Using with Rocket

```rust
use rocket::{Build, Rocket};
use utoipa::{OpenApi};
use utoipa_scalar_warpper::Scalar;

#[rocket::launch]
fn rocket() -> Rocket<Build> {
    #[derive(OpenApi)]
    #[openapi(
        tags(
            (name = "todos", description = "Todo items management API")
        )
    )]
    struct ApiDoc;

    rocket::build()
        .mount(
            "/",
            Scalar::new(ApiDoc::openapi())
                .with_url("/scalar")
                .with_title("My API Documentation"),
        )
        // Add your other routes...
}
```

## Configuration Options

You can customize Scalar's appearance and behavior through the `Config` struct:

```rust
use utoipa_scalar_warpper::{Scalar, Config};

let config = Config::default()
    .theme("saturn")           // Set theme
    .editable(false)           // Whether to allow editing
    .hide_models(false)        // Whether to hide models
    .show_sidebar(true);       // Whether to show sidebar

let scalar = Scalar::new(api)
    .with_config(config)
    .with_url("/scalar")
    .with_title("My API Documentation");
```

## Examples

The project includes examples for the following frameworks:

- `examples/todo-actix` - Actix-web example
- `examples/todo-axum` - Axum example
- `examples/todo-rocket` - Rocket example

Running the examples:

```bash
# For Axum example
cd examples/todo-axum
cargo run

# For Actix-web example
cd examples/todo-actix
cargo run

# For Rocket example
cd examples/todo-rocket
cargo run --bin todo-rocket --features rocket
```

## Build System

This project uses xtask to automatically download and compress Scalar front-end resources, and needs to install `nodejs`
and `pnpm` in advance with the command `cargo xtask upgrade-scalar-api-reference`.

1. Check if the static directory exists
2. If not, install the latest Scalar API reference library
3. Compress JavaScript resources using Terser
4. Embed the compressed files into the binary

## License

This project is dual-licensed under Apache License Version 2.0 or MIT License.
